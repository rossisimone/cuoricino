###################################################################################################
#
#                       This file is part of the LifeV Library                       
#                Copyright (C) 2004, 2005, 2007 EPFL, Politecnico di Milano, INRIA
#                Copyright (C) 2010 EPFL, Politecnico di Milano, Emory University
#
#      Author(s): Umberto Villa <uvilla@emory.edu>
#                 Tiziano Passerini <tiziano@mathcs.emory.edu>
#           Date: 10-12-2010
#  License Terms: GNU LGPL
#
###################################################################################################
### TESTSUITE: DARCY ##############################################################################
###################################################################################################

AT_SETUP([test_darcy])
AT_KEYWORDS([test_darcy darcy])
AT_DATA([data],[[

# -*- getpot -*- (GetPot mode activation for emacs)
#-------------------------------------------------
#          Data file for a Darcy problem
#-------------------------------------------------
[exporter]
type       = hdf5
folder     = ./
multimesh  = false   # actually we export also the displacement
start      = 0
save       = 1
file_name   = PressureVelocity
name_primal = Pressure
name_dual   = Valocity
[../]

[darcy]
# linear = 1, nonLinear = 2, transient = 3, transientNonLinear = 4
problem_type = 1

    # used for nonLinear and transientNonLinear
    [./non-linear]
    fixed_point_iteration = 200
    fixed_point_toll      = 1.e-6
    [../]

    # used for transient and transientNonLinear
    [./time_discretization]
    initialtime   = 0.
    endtime       = 0.1875
    timestep      = 0.0625
    [../]

	[./space_discretization]
	mesh_dir      = ./  # the directory where the mesh file is
	mesh_file     = cartesian_cube8.mesh #hexahexa10x10x10.mesh
	mesh_type     = .mesh #structured #.mesh
    mesh_faces    = all
	verbose       = 1                        # verbose during mesh-reading
	# 0 -> tetra, 1 -> hexa
	element_shape = 0
    # For structured mesh
    nx = 8
    ny = 8
    nz = 8
	[../]

	[./miscellaneous]
	verbose          = 0
	[../]

	[./prec]
	# ML, Ifpack
	prectype                = Ifpack
	reuse                   = false
	displayList             = false

		[./ML]
		analyze_smoother        = false
		default_parameter_list 	= SA    # for ML precond, none SA, DD, DD-ML, maxwell, NSSA, DD-ML-LU, DD-LU
        max_levels              = 2

			[./smoother]
			# smoother type
			# Aztec, IFPACK, Jacobi, ML symmetric Gauss-Seidel, symmetric Gauss-Seidel,
			# ML Gauss-Seidel, Gauss-Seidel, Chebyshev, MLS, Hiptmair, Amesos-KLU,
			# Amesos-Superlu, Amesos-UMFPACK, Amesos-Superludist, Amesos-MUMPS,
			# user-defined, SuperLU, IFPACK-Chebyshev, self, do-nothing,
			# IC, ICT, ILU, ILUT
			type                    = IFPACK
			pre_or_post             = both
			sweeps                  = 3
			damping_factor          = 1
			[../]

			[./coarse]
			type                    = Amesos-UMFPACK
			sweeps                  = 1
			pre_or_post             = both
			max_size                = 1024
			[../]

			[./repartition]
			enable                  = 1
			partitioner             = ParMETIS
			max_min_ration          = 1.3
			min_per_proc            = 500
			[../]

			[./energy_minimization]
			enable			= true
			type			= 3
			[../]
		[../]

# ifpack
		[./ifpack]
		prectype               = Amesos    # Amesos (does a local LU factorization), ILUT (not ILU)
		overlap                = 3

			[./relaxation]
			type                   = Jacobi
			damping_factor         = 1.
			sweeps                 = 1
			min_diagonal_value     = 0
			zero_starting_solution = true
			[../]

			[./partitioner]
			# linear, greedy, metis
			type                   = metis
			overlap                = 0
			local_parts            = 1
			root_node              = 0
			use_symmetric_graph    = true
			[../]

			[./amesos]
			# Amesos_Lapack, Amesos_Klu (default), Amesos_Umfpack,
			# Amesos_Superlu, Amesos_Mumps, Amesos_Dscpack
			solvertype             = Amesos_Umfpack
			[../]

			[./fact]
			drop_tolerance         = 1.e-10
			level-of-fill          = 1
			ilut_level-of-fill     = 1
			absolute_threshold     = 0.
			relative_threshold     = 0.
			relax_value            = 0.
			[../]

			[./schwarz]
			combine_mode           = 0
			compute_condest        = false
			reordering_type        = none
			filter_singletons      = true
			[../]
       [../]
   [../]

   [./solver]
   solver          = gmres #gmres cg
   scaling         = none
   output          = all # none
   conv            = rhs
   max_iter        = 100
   reuse           = false
   max_iter_reuse  = 0
   kspace          = 100
   tol             = 1.e-8    # AztecOO tolerance
   [../]
[../]

]])
AT_CHECK([ln -sf ../../data/mesh/inria/cartesian_cube8.mesh;
          mpirun -np 2 ../../test_darcy/test_darcy -c],[0],[ignore],[ignore])
AT_CLEANUP


